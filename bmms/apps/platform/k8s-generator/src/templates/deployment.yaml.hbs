apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{name}}
  namespace: {{namespace}}
  labels:
    app: {{name}}
    {{#if model}}
    model: {{model}}
    {{/if}}
spec:
  replicas: {{replicas}}
  selector:
    matchLabels:
      app: {{name}}
  template:
    metadata:
      labels:
        app: {{name}}
        {{#if metadata.risk}}
        risk: {{metadata.risk}}
        {{/if}}
    spec:
      containers:
        - name: {{name}}
          image: {{image}}
          ports:
            - containerPort: {{port}}
          envFrom:
            - configMapRef:
                name: env
          {{#if envVars}}
          env:
          {{#each envVars}}
            - name: {{@key}}
              value: "{{this}}"
          {{/each}}
          {{/if}}
          resources:
            requests:
              memory: "256Mi"
              cpu: "250m"
            limits:
              memory: "512Mi"
              cpu: "500m"
          livenessProbe:
            httpGet:
              path: /health
              port: {{port}}
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /health
              port: {{port}}
            initialDelaySeconds: 10
            periodSeconds: 5
      restartPolicy: Always
